---
title: "R script - Caso de estudio Bellabeat"
author: "Jairo Andrés Amaya Muñoz"
date: "2023-02-17"
output: html_document
---

Cargue de librerias

```{r setup, include=FALSE}
library(tidyverse)
library(lubridate)
```

Direccion de los archivos y 4 grupos de archivos: 
actividad diaria (+ sueño), actividad por hora, peso y ritmo cardiaco.

```{r}
path_pc_local <- "D:/RStudio/Fitabase Data 4.12.16-5.12.16"

activityday <- read_csv(file.path(path_pc_local, "dailyActivity_merged.csv"))
sleepday <- read_csv(file.path(path_pc_local, "sleepDay_merged.csv"))

calorieshour <- read_csv(file.path(path_pc_local, "hourlyCalories_merged.csv"))
stepshour <- read_csv(file.path(path_pc_local, "hourlySteps_merged.csv"))
intensitieshour <- read_csv(file.path(path_pc_local, "hourlyIntensities_merged.csv"))

weight <- read_csv(file.path(path_pc_local, "weightLogInfo_merged.csv"))

heartrate <- read_csv(file.path(path_pc_local, "heartrate_seconds_merged.csv"))
```

Vemos que tenemos registros de 33 usuarios para activityday, calorieshour, stepshour e intensitieshour. 24 usuarios para sleepday, 8 para weight y 14 para heartrate. Si bien algunos registran datos de menos usuarios, pueden llegar a darnos información útil.

Chequeamos si hay valores NA o filas duplicadas.


```{r}

n_distinct(activityday$Id) ; n_distinct(sleepday$Id)
n_distinct(calorieshour$Id) ; n_distinct(stepshour$Id) ; n_distinct(intensitieshour$Id)
n_distinct(weight$Id) ; n_distinct(heartrate$Id)

sum(is.na(activityday)) ; sum(is.na(sleepday))
sum(is.na(calorieshour)) ; sum(is.na(stepshour)) ; sum(is.na(intensitieshour))
sum(is.na(weight)) ; sum(is.na(heartrate))

sum(duplicated(activityday)) ; sum(duplicated(sleepday))
sum(duplicated(calorieshour)) ; sum(duplicated(stepshour)) ; sum(duplicated(intensitieshour))
sum(duplicated(weight)) ; sum(duplicated(heartrate))
```

weight tiene 65 NA y sleepday tiene 3 filas duplicadas.
Dejamos los NA de la columna Fat de weight ya que no afectan, y borramos los 3 duplicados de sleepday.

```{r}
glimpse(weight)
weight %>%
      filter(is.na(Fat))

sleepday <- distinct(sleepday)
sum(duplicated(sleepday))
```

Cambiamos las estampillas de tiempo en texto a formato date o datetime.
Los diarios, el peso y el weight tendrán date y los por hora y el ritmo cardíaco tendrán datetime.

```{r}
activityday <- activityday %>%
  mutate(ActivityDate = date(mdy(ActivityDate))) %>%
  rename(date = ActivityDate)
sleepday <- sleepday %>%
  mutate(SleepDay = date(mdy_hms(SleepDay))) %>%
  rename(date = SleepDay)
weight <- weight %>%
  mutate(Date = date(mdy_hms(Date))) %>%
  rename(date = Date)

calorieshour <- calorieshour %>%
  mutate(ActivityHour = mdy_hms(ActivityHour)) %>%
  rename(datetime = ActivityHour)
stepshour <- stepshour %>%
  mutate(ActivityHour = mdy_hms(ActivityHour)) %>%
  rename(datetime = ActivityHour)
intensitieshour <- intensitieshour %>%
  mutate(ActivityHour = mdy_hms(ActivityHour)) %>%
  rename(datetime = ActivityHour)
heartrate <- heartrate %>%
  mutate(Time = mdy_hms(Time)) %>%
  rename(datetime = Time)

glimpse(calorieshour)
```

Ahora uniremos algunos archivos basados en su usuario Id y estampilla de tiempo.
Entonces quedaremos con activityday, activityhour, weight y heartrate listos y limpios.

```{r}
activityday <- activityday %>%
  left_join(sleepday, by=c("Id", "date"))

activityhour <- calorieshour %>%
  inner_join(stepshour, by=c("Id", "datetime")) %>%
  inner_join(intensitieshour, by=c("Id", "datetime"))
```

Un ultimo vistazo:
Chequeamos que los valores tengan rangos normales.
Todos tienen rangos de valores que son posibles y no irreales.

```{r}
glimpse(activityday)
summary(activityday)

glimpse(activityhour)
summary(activityhour)

glimpse(weight)
summary(weight)

glimpse(heartrate)
summary(heartrate)
```

.....
